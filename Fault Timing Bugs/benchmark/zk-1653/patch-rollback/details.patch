--- Learner.java	2019-03-21 15:04:35.458524289 -0500
+++ ../patch/Learner.java	2019-03-21 15:04:35.482524992 -0500
@@ -482,9 +482,12 @@
                            e.printStackTrace();
                        }
                    }
-                   
+                    DFix.StartMark(); 
+		    DFix.RecordSnapShot(); // snapshot is a determistic location for zookeeper
                     zk.takeSnapshot();
+		    DFix.RecordCEpoch();// current epoch location is also determistic 
                     self.setCurrentEpoch(newEpoch);
+		    DFix.EndMark();
                     writePacket(new QuorumPacket(Leader.ACK, newLeaderZxid, null, null), true);
                     break;
                 }
--- QuorumPeer.java	2019-03-21 15:04:35.462524406 -0500
+++ ../patch/QuorumPeer.java	2019-03-21 15:04:35.502525579 -0500
@@ -651,6 +651,7 @@
             	        currentEpoch);
             	writeLongToFile(CURRENT_EPOCH_FILENAME, currentEpoch);
             }
+	    DFix.RollBack();
             if (epochOfZxid > currentEpoch) {
                 throw new IOException("The current epoch, " + ZxidUtils.zxidToString(currentEpoch) + ", is older than the last zxid, " + lastProcessedZxid);
             }
